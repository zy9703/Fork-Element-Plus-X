<script setup lang="ts">
import type { GroupableOptions } from 'vue-element-plus-x/src/components/Conversations/types'
import { Calendar, ChatDotRound, ChatLineRound, Delete, Document, DocumentChecked, DocumentCopy, Download, Edit, InfoFilled, Lock, Message, MoreFilled, Search, Setting, Share, Star, StarFilled } from '@element-plus/icons-vue'
import { ElMessage } from 'element-plus'
import Conversations from 'vue-element-plus-x/src/components/Conversations/index.vue'

const timeBasedItems = ref([
  {
    key: '1',
    label: 'ä»Šå¤©çš„ä¼šè¯111111111111111111111111111',
    group: 'today',
    disabled: true
  },
  {
    key: '2',
    label: 'ä»Šå¤©çš„ä¼šè¯2',
  },
  {
    key: '3',
    label: 'æ˜¨å¤©çš„ä¼šè¯1',
  },
  {
    key: '4',
    label: 'æ˜¨å¤©çš„ä¼šè¯2',
  },
  {
    key: '5',
    label: 'ä¸€å‘¨å‰çš„ä¼šè¯',
  },
  {
    key: '6',
    label: 'ä¸€ä¸ªæœˆå‰çš„ä¼šè¯',
  },
  {
    key: '7',
    label: 'å¾ˆä¹…ä»¥å‰çš„ä¼šè¯',
  },
])

// æµ‹è¯•æ•°æ® - æœ‰groupå­—æ®µçš„ä¼šè¯
const groupBasedItems = ref([
  {
    key: 'g1',
    label: 'å·¥ä½œæ–‡æ¡£1',
    group: 'å·¥ä½œ'
  },
  {
    key: 'g2',
    label: 'å·¥ä½œæ–‡æ¡£11111111111111111111111111111111111111111',
    group: 'å·¥ä½œ'
  },
  {
    key: 'g3',
    label: 'å·¥ä½œæ–‡æ¡£3',
    group: 'å·¥ä½œ'
  },
  {
    key: 'g4',
    label: 'å·¥ä½œæ–‡æ¡£4',
    group: 'å·¥ä½œ'
  },
  {
    key: 'g5',
    label: 'å·¥ä½œæ–‡æ¡£5',
    group: 'å·¥ä½œ'
  },
  {
    key: 'g6',
    label: 'å·¥ä½œæ–‡æ¡£6',
    group: 'å·¥ä½œ'
  },
  {
    key: 'g7',
    label: 'å­¦ä¹ ç¬”è®°1',
    group: 'å­¦ä¹ '
  },
  {
    key: 'g8',
    label: 'å­¦ä¹ ç¬”è®°2',
    group: 'å­¦ä¹ '
  },
  {
    key: 'g9',
    label: 'ä¸ªäººæ–‡æ¡£1',
    group: 'ä¸ªäºº'
  },
  {
    key: 'g10',
    label: 'æœªåˆ†ç»„é¡¹ç›®'
  },
])

// æµ‹è¯•æ•°æ® - ç”¨äºèœå•æµ‹è¯•çš„ä¼šè¯
const menuTestItems = ref([
  {
    key: 'm1',
    label: 'èœå•æµ‹è¯•é¡¹ç›® 1 - é•¿æ–‡æœ¬æ•ˆæœæ¼”ç¤ºæ–‡æœ¬é•¿åº¦æº¢å‡ºæ•ˆæœæµ‹è¯•'
  },
  {
    key: 'm2',
    label: 'èœå•æµ‹è¯•é¡¹ç›® 2'
  },
  {
    key: 'm3',
    label: 'èœå•æµ‹è¯•é¡¹ç›® 3'
  },
  {
    key: 'm4',
    label: 'èœå•æµ‹è¯•é¡¹ç›® 4'
  },
  {
    key: 'm5',
    label: 'èœå•æµ‹è¯•é¡¹ç›® 5'
  },
])

// æµ‹è¯•æ•°æ® - ç”¨äºæœç´¢åŠŸèƒ½å’Œå›¾æ ‡åŠŸèƒ½æµ‹è¯•çš„ä¼šè¯
const searchTestItems = ref([
  {
    key: 'i1',
    label: 'é‡è¦æ–‡æ¡£Alpha',
    prefixIcon: h(Star)
  },
  {
    key: 'i2',
    label: 'é‡è¦ä¼šè®®Beta',
    prefixIcon: h(StarFilled)
  },
  {
    key: 'i3',
    label: 'æ™®é€šæ–‡æ¡£Alpha',
    prefixIcon: h(Document)
  },
  {
    key: 'i4',
    label: 'ç§å¯†æ–‡æ¡£Secret',
    prefixIcon: h(Lock)
  },
  {
    key: 'i5',
    label: 'æ—¥ç¨‹Alpha',
    prefixIcon: h(Calendar)
  },
  {
    key: 'i6',
    label: 'å¤‡ä»½æ–‡æ¡£Beta',
    prefixIcon: h(DocumentCopy)
  },
  {
    key: 'i7',
    label: 'ç³»ç»Ÿè®¾ç½®',
    prefixIcon: h(Setting)
  },
  {
    key: 'i8',
    label: 'å·²å®Œæˆä»»åŠ¡',
    prefixIcon: h(DocumentChecked)
  },
])

// æµ‹è¯•æ•°æ® - æ‡’åŠ è½½æµ‹è¯•
const lazyItems = ref([
  {
    key: 'l1',
    label: 'åˆå§‹é¡¹ç›®1',
    prefixIcon: h(ChatLineRound)
  },
  {
    key: 'l2',
    label: 'åˆå§‹é¡¹ç›®2',
    prefixIcon: h(ChatDotRound)
  },
  {
    key: 'l3',
    label: 'åˆå§‹é¡¹ç›®3',
    prefixIcon: h(ChatLineRound)
  },
  {
    key: 'l1',
    label: 'åˆå§‹é¡¹ç›®1',
    prefixIcon: h(ChatLineRound)
  },
  {
    key: 'l2',
    label: 'åˆå§‹é¡¹ç›®2',
    prefixIcon: h(ChatDotRound)
  },
  {
    key: 'l3',
    label: 'åˆå§‹é¡¹ç›®3',
    prefixIcon: h(ChatLineRound)
  },
  {
    key: 'l1',
    label: 'åˆå§‹é¡¹ç›®1',
    prefixIcon: h(ChatLineRound)
  },
  {
    key: 'l2',
    label: 'åˆå§‹é¡¹ç›®2',
    prefixIcon: h(ChatDotRound)
  },
  {
    key: 'l3',
    label: 'åˆå§‹é¡¹ç›®3',
    prefixIcon: h(ChatLineRound)
  },
])

// è‡ªå®šä¹‰åˆ†ç»„é€‰é¡¹
const customGroupOptions: GroupableOptions = {
  // è‡ªå®šä¹‰åˆ†ç»„æ’åºï¼Œå­¦ä¹  > å·¥ä½œ > ä¸ªäºº > æœªåˆ†ç»„
  sort: (a, b) => {
    const order: Record<string, number> = { å­¦ä¹ : 0, å·¥ä½œ: 1, ä¸ªäºº: 2, æœªåˆ†ç»„: 3 }
    const orderA = order[a] !== undefined ? order[a] : 999
    const orderB = order[b] !== undefined ? order[b] : 999
    return orderA - orderB
  },
}

// èœå•é¡¹ç›®å®šä¹‰
const conversationMenuItems = [
  {
    key: 'edit',
    label: 'ç¼–è¾‘',
    icon: h(Edit),
  },
  {
    key: 'delete',
    label: 'åˆ é™¤',
    icon: h(Delete),
  },
  {
    key: 'share',
    label: 'åˆ†äº«',
    icon: h(Share),
  },
]

// æœç´¢ç›¸å…³
const searchValue = ref('')
const searchResults = ref([...searchTestItems.value])

// æœç´¢å¤„ç†å‡½æ•°
function handleSearch(value: string) {
  if (!value) {
    searchResults.value = [...searchTestItems.value]
    return
  }

  searchResults.value = searchTestItems.value.filter(item =>
    item.label.toLowerCase().includes(value.toLowerCase()),
  )
}

// åŠ è½½æ›´å¤šå¤„ç†
const isLoading = ref(false)

function loadMoreItems() {
  if (isLoading.value)
    return

  isLoading.value = true
  ElMessage.info('åŠ è½½æ›´å¤šæ•°æ®...')

  // æ¨¡æ‹Ÿå¼‚æ­¥åŠ è½½
  setTimeout(() => {
    const newItems = [
      {
        key: `l${lazyItems.value.length + 1}`,
        label: `åŠ è½½çš„é¡¹ç›®${lazyItems.value.length + 1}`,
        prefixIcon: h(ChatLineRound)
      },
      {
        key: `l${lazyItems.value.length + 2}`,
        label: `åŠ è½½çš„é¡¹ç›®${lazyItems.value.length + 2}`,
        prefixIcon: h(ChatDotRound)
      },
    ]

    lazyItems.value = [...lazyItems.value, ...newItems]
    isLoading.value = false
  }, 1000)
}

// æ¿€æ´»çš„é”®
const activeKey1 = ref('1')
const activeKey2 = ref('g1')
const activeKey4 = ref('m1')
const activeKey5 = ref('i1')
const activeKey6 = ref('l1')
const activeKey7 = ref('d1')

// å¤„ç†èœå•ç‚¹å‡»
function handleMenuClick(menuKey: string, item: any) {
  switch (menuKey) {
    case 'edit':
      ElMessage.info(`ç¼–è¾‘: ${item.label}`)
      break
    case 'delete':
      ElMessage.warning(`åˆ é™¤: ${item.label}`)
      break
    case 'share':
      ElMessage.success(`åˆ†äº«: ${item.label}`)
      break
  }
}
</script>

<template>
  <div class="demo-container">
    <h2>åŸºç¡€æ—¶é—´åˆ†ç»„ (groupable)</h2>
    <div class="demo-card">
      <Conversations
        v-model:active="activeKey1"
        :items="timeBasedItems"
        groupable
        :label-max-width="200"
        :show-tooltip="true"
      />
    </div>

    <h2>è‡ªå®šä¹‰åˆ†ç»„ (groupableä¸ºå¯¹è±¡)</h2>
    <div class="demo-card">
      <Conversations
        v-model:active="activeKey2"
        :items="groupBasedItems"
        :groupable="customGroupOptions"
        :label-max-width="200"
        :show-tooltip="true"
      >
        <template #groupTitle="{ group }">
          <div class="custom-group-title">
            <!-- ä¸ºä¸åŒç»„æ·»åŠ ä¸åŒçš„å‰ç¼€ -->
            <span v-if="group.title === 'å·¥ä½œ'">ğŸ“Š </span>
            <span v-else-if="group.title === 'å­¦ä¹ '">ğŸ“š </span>
            <span v-else-if="group.title === 'ä¸ªäºº'">ğŸ  </span>
            <span v-else>ğŸ“ </span>
            {{ group.title }}
          </div>
        </template>
      </Conversations>
    </div>

    <h2>èœå•åŠŸèƒ½æµ‹è¯•</h2>
    <div class="demo-card">
      <Conversations
        v-model:active="activeKey4"
        :items="menuTestItems"
        :label-max-width="200"
        :show-tooltip="true"
      >
        <template #menu="{ item }">
          <div class="menu-buttons">
            <el-button
              v-for="menuItem in conversationMenuItems"
              :key="menuItem.key"
              type="text"
              size="small"
              @click.stop="handleMenuClick(menuItem.key, item)"
            >
              <el-icon v-if="menuItem.icon">
                <component :is="menuItem.icon" />
              </el-icon>
              <span v-if="menuItem.label">{{ menuItem.label }}</span>
            </el-button>
          </div>
        </template>
      </Conversations>
    </div>

    <h2>æœç´¢å’Œå›¾æ ‡åŠŸèƒ½</h2>
    <div class="demo-card">
      <Conversations
        v-model:active="activeKey5"
        :search="searchValue"
        :items="searchResults"
        :label-max-width="200"
        :show-tooltip="true"
      />
      <!-- :search-method="handleSearch" -->
    </div>

    <h2>åŠ è½½æ›´å¤šåŠŸèƒ½</h2>
    <div class="demo-card">
      <Conversations
        v-model:active="activeKey6"
        :items="lazyItems"
        :label-max-width="200"
        :show-tooltip="true"
        :load-more="loadMoreItems"
      />
    </div>
  </div>
</template>

<style scoped lang="scss">
.demo-container {
  padding: 20px;

  h2 {
    margin-top: 30px;
    margin-bottom: 8px;
    font-size: 18px;
  }

  .description {
    color: #909399;
    font-size: 14px;
    margin-bottom: 16px;
  }

  .demo-card {
    border: 1px solid #ebeef5;
    border-radius: 8px;
    overflow: hidden;
    height: 400px;
    margin-bottom: 30px;
    background-color: #fff;
    box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
  }
}

.custom-group-title {
  display: flex;
  align-items: center;
  font-weight: 500;
  color: #409EFF;
}

.menu-buttons {
  display: flex;
  gap: 8px;
  align-items: center;

  .el-button {
    padding: 4px 8px;
    margin-left: 0;

    .el-icon {
      margin-right: 2px;
    }
  }
}
</style>
