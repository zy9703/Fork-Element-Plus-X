<template>
  <div class="component-container">
    <div class="demo-section">
      <h2>åŸºç¡€ç”¨æ³•</h2>
      <p class="demo-desc">æœ€ç®€å•çš„ä½¿ç”¨æ–¹å¼ï¼Œåªéœ€æä¾›å†…å®¹</p>
      <A3Bubble content="è¿™æ˜¯ä¸€æ¡ç®€å•çš„æ¶ˆæ¯" placement="start" />
      <A3Bubble content="è¿™æ˜¯ç”¨æˆ·å‘é€çš„æ¶ˆæ¯" placement="end" />
    </div>

    <div class="demo-section">
      <h2>ä½ç½®ä¸å¤´åƒ</h2>
      <p class="demo-desc">æ”¯æŒå·¦å³ä½ç½®å’Œä¸åŒçš„å¤´åƒæ˜¾ç¤ºæ–¹å¼</p>
      
      <!-- å·¦ä¾§-å¤´åƒURL -->
      <A3Bubble 
        content="æ”¯æŒé€šè¿‡avatarå±æ€§è®¾ç½®å¤´åƒURL" 
        placement="start"
        avatar="https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png"
        avatarSize="40"
      />

      <!-- å·¦ä¾§-å¤´åƒå ä½ -->
      <div style="margin-top: 10px;"></div>
      <A3Bubble 
        content="æ”¯æŒè®¾ç½®å¤´åƒå ä½ç©ºé—´" 
        placement="start"
        avatarSize="40"
      />

      <!-- å³ä¾§-æ’æ§½å¤´åƒ -->
      <div style="margin-top: 10px;"></div>
      <A3Bubble 
        content="æ”¯æŒé€šè¿‡æ’æ§½è‡ªå®šä¹‰å¤´åƒ" 
        placement="end">
        <template #avatar>
          <el-avatar 
            :size="40" 
            :src="avatar" 
            style="background-color: #409EFF;"
          />
        </template>
      </A3Bubble>

      <!-- è‡ªå®šä¹‰å¤´åƒé—´è· -->
      <div style="margin-top: 10px;"></div>
      <A3Bubble 
        content="æ”¯æŒé€šè¿‡avatarGapè®¾ç½®å¤´åƒä¸å†…å®¹çš„é—´è·" 
        placement="start"
        avatar="https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png"
        avatarSize="40"
        avatarGap="24px"
      />

      <!-- æ–¹å½¢å¤´åƒ -->
      <div style="margin-top: 10px;"></div>
      <A3Bubble 
        content="æ”¯æŒè®¾ç½®æ–¹å½¢å¤´åƒ" 
        placement="start"
        avatar="https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png"
        avatarSize="40"
        avatarShape="square"
      />
    </div>

    <div class="demo-section">
      <h2>å¤´éƒ¨ã€åº•éƒ¨ä¸å†…å®¹åŒºæ’æ§½</h2>
      <p class="demo-desc">æ”¯æŒè‡ªå®šä¹‰æ°”æ³¡å¤´éƒ¨ã€åº•éƒ¨ä¸å†…å®¹åŒº</p>
      <A3Bubble
        content="è¿™æ˜¯ä¸€æ¡å¸¦æœ‰è‡ªå®šä¹‰å¤´éƒ¨å’Œåº•éƒ¨çš„æ¶ˆæ¯"
      >
        <template #header>
          <div class="custom-header">
            <span>ç”¨æˆ·å</span>
            <span class="time">14:30</span>
          </div>
        </template>
        <template #footer>
          <div class="custom-footer">
            <el-button type="text" icon="el-icon-refresh" ></el-button>
            <el-button type="text" icon="el-icon-copy-document" ></el-button>
          </div>
        </template>
      </A3Bubble>

      <!-- è‡ªå®šä¹‰å†…å®¹ -->
      <div style="margin-top: 10px;"></div>
      <A3Bubble>
        <template #content>
          <div class="custom-content">
            è¿™æ˜¯é€šè¿‡<strong>å†…å®¹æ’æ§½</strong>è‡ªå®šä¹‰çš„æ¶ˆæ¯ã€‚
            <el-progress :percentage="50" />
          </div>
        </template>
      </A3Bubble>
    </div>
    <div class="demo-section">
      <h2>æ°”æ³¡å½¢çŠ¶ã€å˜ä½“ä¸æœ€å¤§å®½åº¦</h2>
      <p class="demo-desc">æ”¯æŒä¸åŒçš„å½¢çŠ¶å’Œæ ·å¼å˜ä½“</p>
      
      <!-- åœ†è§’ -->
      <A3Bubble 
        content="åœ†è§’å½¢çŠ¶" 
        placement="start"
        shape="round"
      />

      <!-- ç›´è§’ -->
      <div style="margin-top: 10px;"></div>
      <A3Bubble 
        content="ç›´è§’å½¢çŠ¶" 
        placement="start"
        shape="corner"
      />

      <!-- å¡«å…… -->
      <div style="margin-top: 10px;"></div>
      <A3Bubble 
        content="å¡«å……å˜ä½“ (é»˜è®¤)" 
        placement="start"
        variant="filled"
      />

      <!-- æ— è¾¹æ¡† -->
      <div style="margin-top: 10px;"></div>
      <A3Bubble 
        content="æ— è¾¹æ¡†å˜ä½“" 
        placement="start"
        variant="borderless"
      />

      <!-- è½®å»“ -->
      <div style="margin-top: 10px;"></div>
      <A3Bubble 
        content="è½®å»“å˜ä½“" 
        placement="start"
        variant="outlined"
      />

      <!-- é˜´å½± -->
      <div style="margin-top: 10px;"></div>
      <A3Bubble 
        content="é˜´å½±å˜ä½“" 
        placement="start"
        variant="shadow"
      />

      <!-- æ— æ ·å¼ -->
      <div style="margin-top: 10px;"></div>
      <A3Bubble 
        content="æ— æ ·å¼" 
        placement="start"
        :noStyle="true"
      />

      <p class="demo-desc">æ”¯æŒè®¾ç½®æ°”æ³¡æœ€å¤§å®½åº¦</p>
      <A3Bubble 
        content="è¿™æ˜¯ä¸€æ¡è®¾ç½®äº†æœ€å¤§å®½åº¦ä¸º300pxçš„æ¶ˆæ¯ï¼Œå½“å†…å®¹è¶…è¿‡è¿™ä¸ªå®½åº¦æ—¶ä¼šè‡ªåŠ¨æ¢è¡Œã€‚è¿™æ˜¯ä¸€æ¡å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿çš„æ¶ˆæ¯ã€‚" 
        placement="start"
        maxWidth="300px"
      />
    </div>
    
    <div class="demo-section">
      <h2>æ‰“å­—æ•ˆæœ</h2>
      <p class="demo-desc">æ”¯æŒæ¸è¿›å¼æ‰“å­—æ•ˆæœ</p>

      <div style="margin-bottom: 15px;">
        <el-button style="width: fit-content;" @click="refreshTypingContent">
          é»˜è®¤æ‰“å­—æ•ˆæœ
        </el-button>
      </div>
      <A3Bubble 
        :content="refreshContent" 
        :loading="loading"
        :typing="true" 
      />
      
      <div style="margin-top: 20px;"></div>
      <p class="demo-desc">æ”¯æŒè‡ªå®šä¹‰æ‰“å­—é€Ÿåº¦ã€æ­¥é•¿å’Œå…‰æ ‡</p>

      <div style="margin-bottom: 15px;">
        <el-button style="width: fit-content;" @click="changeTypingContent">
          è‡ªå®šä¹‰æ‰“å­—æ•ˆæœ
        </el-button>
      </div>
      
      <A3Bubble 
        :content="typingContent" 
        :typing="{ 
          step: 1,        // æ¯æ¬¡æ˜¾ç¤º1ä¸ªå­—ç¬¦
          interval: 100,  // æ¯100æ¯«ç§’æ˜¾ç¤ºä¸€æ¬¡
          suffix: 'â¤ï¸'    // ä½¿ç”¨å¿ƒå½¢ä½œä¸ºå…‰æ ‡
        }"
      >
        <template #avatar>
          <el-avatar :size="40" :src="avatar" />
        </template>
      </A3Bubble>
    </div>
    
    <div class="demo-section">
      <h2>åŠ è½½çŠ¶æ€</h2>
      <p class="demo-desc">æ”¯æŒåŠ è½½çŠ¶æ€æ˜¾ç¤º</p>
      
      <!-- åŸºç¡€åŠ è½½çŠ¶æ€ -->
      <div style="margin-bottom: 15px;">
        <A3Bubble :loading="loadingDemo" content="hello world !"/>
      </div>

      <!-- è‡ªå®šä¹‰åŠ è½½å†…å®¹ -->
      <div style="margin-bottom: 15px;">
        <A3Bubble :loading="loadingDemo" content="hello world !">
          <template #loading>
            <div>loading...</div>
          </template>
        </A3Bubble>
      </div>

      <!-- å¸¦æ–‡æœ¬çš„è‡ªå®šä¹‰åŠ è½½å†…å®¹ -->
      <div style="margin-bottom: 15px;">
        <A3Bubble :loading="loadingDemo" content="hello world !">
          <template #loading>
            <div style="padding: 0; margin: 0;">æ„Ÿè°¢ä½¿ç”¨ Element-Plus-X ğŸŒ¹ è¯·ç¨å...</div>
          </template>
        </A3Bubble>
      </div>

      <!-- åŠ è½½çŠ¶æ€åˆ‡æ¢ -->
      <div class="loading-control">
        <span>çŠ¶æ€ï¼š</span>
        <el-switch v-model="loadingDemo" />
      </div>
    </div>

    <div class="demo-section">
      <h2>Markdownæ”¯æŒ</h2>
      <p class="demo-desc">æ”¯æŒMarkdownå†…å®¹æ¸²æŸ“</p>
      <A3Bubble
        :content="markdownContent"
        :is-markdown="true"
      />
    </div>

    
    <div class="demo-section">
      <h2>ç»„ä»¶å®ä¾‹æ–¹æ³•æ¼”ç¤º</h2>
      <p class="demo-desc">æ”¯æŒæ§åˆ¶æ‰“å­—è¿‡ç¨‹å’ŒçŠ¶æ€</p>
      <div class="control-buttons">
        <el-button size="small" @click="handleStart">å¼€å§‹æ‰“å­—</el-button>
        <el-button size="small" @click="handleInterrupt">æš‚åœ</el-button>
        <el-button size="small" @click="handleContinue">ç»§ç»­</el-button>
        <el-button size="small" @click="handleRestart">é‡æ–°å¼€å§‹</el-button>
        <el-button size="small" @click="handleDestroy">é”€æ¯</el-button>
      </div>
      <div style="margin-top: 10px;"></div>
      <div v-if="progress > 0">
        <el-progress :percentage="progress" :stroke-width="5" />
      </div>
      <div style="margin-top: 10px;"></div>
      <A3Bubble
        ref="controlBubble"
        :content="controlContent"
        :typing="true"
        @start="onBubbleStart"
        @writing="onBubbleWriting"
        @finish="onBubbleFinish"
      />
    </div>
    
    <div class="demo-section">
      <h2>å®Œæ•´ç¤ºä¾‹</h2>
      <p class="demo-desc">ç»¼åˆå±•ç¤ºå¤šä¸ªç‰¹æ€§</p>
      <A3Bubble
        placement="start"
        :content="content"
        shape="corner"
        variant="shadow"
        :loading="loading"
        :typing="{
          step: 2,
          suffix: 'ğŸ’—',
        }"
        :is-markdown="true"
      >
        <template #avatar>
          <el-avatar :size="32" :src="avatar" />
        </template>

        <template #header>
          <div>æˆ‘æ˜¯å¤´éƒ¨å†…å®¹</div>
        </template>

        <template #footer>
          <div>
            <el-button type="info" icon="el-icon-refresh" size="small" circle />
            <el-button type="success" icon="el-icon-search" size="small" circle />
            <el-button type="warning" icon="el-icon-star-off" size="small" circle />
            <el-button type="primary" icon="el-icon-document-copy" size="small" circle />
          </div>
        </template>
      </A3Bubble>
    </div>
  </div>
</template>

<script>
import A3Bubble from './index.vue'

export default {
  name: 'BubbleDemo',
  components: {
    A3Bubble
  },
  data() {
    return {
      avatar: 'https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png',
      loading: false,
      content: `
        # æ ‡é¢˜
        è¿™æ˜¯ä¸€ä¸ª Markdown ç¤ºä¾‹ã€‚
        - åˆ—è¡¨é¡¹ 1
        - åˆ—è¡¨é¡¹ 2
        **ç²—ä½“æ–‡æœ¬** å’Œ *æ–œä½“æ–‡æœ¬*
        \`\`\`javascript
        console.log('Hello, world!');
        \`\`\`
      `.trim(),
      markdownContent: `
        # Markdown æ”¯æŒ
        è¿™æ˜¯ä½¿ç”¨ Markdown è¯­æ³•çš„å†…å®¹ç¤ºä¾‹ã€‚

        ## åˆ—è¡¨æ”¯æŒ
        - é¡¹ç›® 1
        - é¡¹ç›® 2
        - é¡¹ç›® 3

        ## ä»£ç æ”¯æŒ
        \`\`\`javascript
        function hello() {
          console.log("Hello World!");
        }
        \`\`\`

        ## æ–‡æœ¬æ ¼å¼åŒ–
        **ç²—ä½“æ–‡æœ¬** å’Œ *æ–œä½“æ–‡æœ¬*

        > å¼•ç”¨æ–‡æœ¬ç¤ºä¾‹
      `.trim(),
      loadingDemo: true,
      refreshContent: 'è¿™æ˜¯ä¸€æ¡å¸¦æ‰“å­—æ•ˆæœçš„æ¶ˆæ¯ï¼Œä¼šè‡ªåŠ¨ä¸€ä¸ªå­—ä¸€ä¸ªå­—åœ°æ˜¾ç¤ºå‡ºæ¥ã€‚',
      controlContent: 'è¿™æ˜¯ä¸€ä¸ªå¯ä»¥é€šè¿‡å®ä¾‹æ–¹æ³•æ§åˆ¶çš„æ°”æ³¡ç»„ä»¶ï¼Œå¯ä»¥æš‚åœã€ç»§ç»­å’Œé‡æ–°å¼€å§‹æ‰“å­—æ•ˆæœã€‚',
      progress: 0,
      destroyed: false,
      typingContent: 'è¿™æ˜¯ä¸€æ¡è‡ªå®šä¹‰æ‰“å­—æ•ˆæœçš„æ¶ˆæ¯ ~ ',
      typingCount: 1
    }
  },
  mounted() {
    // ç¤ºä¾‹ï¼š2ç§’ååŠ è½½å®Œæˆ
    setTimeout(() => {
      this.loading = false;
      this.loadingDemo = true;
    }, 2000);
  },
  methods: {
    toggleLoading() {
      this.loadingDemo = !this.loadingDemo;
    },
    handleStart() {
      if (this.destroyed) {
        this.destroyed = false;
        this.$nextTick(() => {
          if (this.$refs.controlBubble) {
            this.$refs.controlBubble.restart();
          }
        });
      }
    },
    handleInterrupt() {
      if (this.$refs.controlBubble) {
        this.$refs.controlBubble.interrupt();
      }
    },
    handleContinue() {
      if (this.$refs.controlBubble) {
        this.$refs.controlBubble.continueTyping();
      }
    },
    handleRestart() {
      if (this.$refs.controlBubble) {
        this.$refs.controlBubble.restart();
      }
    },
    handleDestroy() {
      if (this.$refs.controlBubble) {
        this.$refs.controlBubble.destroy();
        this.destroyed = true;
      }
    },
    onBubbleStart() {
      this.progress = 0;
      console.log('æ‰“å­—æ•ˆæœå¼€å§‹');
    },
    onBubbleWriting(instance) {
      if (instance && typeof instance.progress === 'number') {
        this.progress = instance.progress;
      }
    },
    onBubbleFinish() {
      this.progress = 100;
      console.log('æ‰“å­—æ•ˆæœå®Œæˆ');
    },
    refreshTypingContent(){
      this.loading = true;
      this.refreshContent = null;
      setTimeout(() => {
        this.loading = false;
        this.refreshContent = 'è¿™æ˜¯ä¸€æ¡å¸¦æ‰“å­—æ•ˆæœçš„æ¶ˆæ¯ï¼Œä¼šè‡ªåŠ¨ä¸€ä¸ªå­—ä¸€ä¸ªå­—åœ°æ˜¾ç¤ºå‡ºæ¥ã€‚';
      }, 1000);
    },
    changeTypingContent() {
      this.typingCount = (this.typingCount || 1) + 1;
      if (this.typingCount > 3) {
        this.typingCount = 1;
      }
      this.typingContent = 'è¿™æ˜¯ä¸€æ¡è‡ªå®šä¹‰æ‰“å­—æ•ˆæœçš„æ¶ˆæ¯ ~ '.repeat(this.typingCount);
    }
  }
}
</script>

<style scoped>
.component-container {
  width: 100%;
}

.demo-section {
  margin-bottom: 40px;
  padding: 20px;
  border: 1px solid #ebeef5;
  border-radius: 4px;
  box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
}

.demo-desc {
  margin-bottom: 15px;
  color: #606266;
  font-size: 14px;
}

.demo-row {
  display: flex;
  align-items: center;
}

h2 {
  margin-top: 0;
  margin-bottom: 10px;
  padding-bottom: 10px;
  border-bottom: 1px solid #ebeef5;
  font-size: 18px;
  font-weight: 500;
  color: #303133;
}

.custom-header {
  display: flex;
  justify-content: space-between;
  font-size: 14px;
  margin: 0;
  padding: 0;
}

.custom-header .time {
  color: #909399;
  font-size: 12px;
}

.custom-footer {
  display: flex;
  justify-content: flex-end;
  gap: 8px;
  margin: 0;
  padding: 0;
}

.custom-content {
  padding: 10px;
}

.control-buttons {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

.loading-control {
  display: flex;
  align-items: center;
  gap: 10px;
}
</style> 